(function(){BX.namespace("BX.Bitrix24");var e=null;var t=false;var s="/bitrix/tools/b24_rename.php";BX.Bitrix24.renamePortal=function(t){var i=BX.create("div",{html:'<div style="margin: 20px; text-align: center;">'+BX.message("JS_CORE_LOADING")+"<br /><br />"+o()+"</div>"});t=BX.type.isDomNode(t)?t:null;if(!e){e=new BX.PopupWindow("b24_portal_rename",t,{closeByEsc:true,closeIcon:true,content:i,angle:t?true:false,offsetTop:13,offsetLeft:13,width:370,zIndex:2e3,events:{onPopupClose:BX.proxy((function(){BX.ajax({method:"POST",dataType:"json",url:s,data:{sessid:BX.bitrix_sessid(),action:"delayDomainSpotLight"},onsuccess:BX.proxy((function(){}),this),onfailure:function(){}})}),this)}});BX.ajax({url:s,method:"POST",data:{sessid:BX.bitrix_sessid()},onsuccess:function(t){i.innerHTML=t;if(!e.isShown()){e.show()}e.adjustPosition()}});setTimeout((function(){if(!e.isShown()){e.show()}}),500)}else{BX.defer(e.show,e)()}};BX.Bitrix24.renamePortal.getPopup=function(){return e};BX.Bitrix24.renamePortal.RenameForm=function(t){this.checkTtl=1e3;this.linkFields=true;this.form=null;this.popup=BX.Bitrix24.renamePortal.getPopup();this.ajaxUrl=t.ajaxUrl;this.formName=t.formName;this.formElements={companyName:t.companyName,domainName:t.domainName};this.params={errorMessage:t.errorMessage,variantListLayout:t.variantListLayout,variantList:t.variantList,variantTpl:t.variantTpl,zoneTpl:t.zoneTpl,errorClassName:t.errorClassName,successClassName:t.successClassName};this.valueChange=BX.debounce(this.checkValue,this.checkTtl,this);e.setButtons([new BX.PopupWindowButton({text:BX.message("JS_CORE_WINDOW_SAVE"),className:"popup-window-button-accept",events:{click:BX.proxy(this.confirm,this)}})]);this.currentStatus=null;BX.ready(BX.proxy(this.init,this))};BX.Bitrix24.renamePortal.RenameForm.prototype={init:function(){this.form=document.forms[this.formName];BX.bind(this.form,"submit",BX.proxy(this.confirm,this));this.formElements["companyName"]=this.form[this.formElements["companyName"]];this.formElements["domainName"]=this.form[this.formElements["domainName"]];this.linkFields=this.formElements["domainName"].value=="";BX.bind(this.formElements["companyName"],"keyup",BX.proxy(this.companyNameChange,this));BX.bind(this.formElements["domainName"],"keyup",BX.proxy(this.domainNameChange,this));BX.bind(this.formElements["domainName"],"focus",BX.proxy(this.domainNameFocus,this));BX.bindDelegate(BX(this.params["variantList"]),"click",{attr:"data-value"},BX.proxy(this.variantClick,this))},companyNameChange:function(){if(!!this.linkFields){this.formElements["domainName"].value=BX.translit(this.formElements["companyName"].value,{replace_space:"",replace_other:""});this.setFormStatus(null);this.valueChange()}},domainNameChange:function(){this.linkFields=false;this.setFormStatus(null);this.valueChange()},domainNameFocus:function(){this.linkFields=false},variantClick:function(){var e=BX.proxy_context.getAttribute("data-value");if(!!e){this.formElements["domainName"].value=e;this.checkValue()}},checkValue:function(){BX.ajax({dataType:"json",url:this.ajaxUrl,method:"POST",data:{action:"check",sessid:BX.bitrix_sessid(),domain:this.formElements.domainName.value,companyname:this.formElements.companyName.value},onsuccess:BX.proxy(this.checkValueResult,this)})},setFormStatus:function(e){BX.removeClass(this.formElements["domainName"],this.params.errorClassName);BX.removeClass(this.formElements["domainName"],this.params.successClassName);this.currentStatus=null;if(e===true){BX.addClass(this.formElements["domainName"],this.params.successClassName);this.currentStatus=true}else if(e===false){BX.addClass(this.formElements["domainName"],this.params.errorClassName);this.currentStatus=false}},checkValueResult:function(e){if(e){if(e.error){BX.removeClass(this.formElements["domainName"],this.params.successClassName);BX.addClass(this.formElements["domainName"],this.params.errorClassName);BX(this.params.errorMessage).innerHTML=e.error;BX.show(BX(this.params.errorMessage));if(!!e.variants){var t="";for(var s=0;s<e.variants.length;s++){t+=this.params.variantTpl.replace(/#domain#/g,e.variants[s])}BX(this.params.variantList).innerHTML=t;BX.show(BX(this.params.variantListLayout))}else{BX.hide(BX(this.params.variantListLayout))}this.setFormStatus(false)}else{BX.hide(BX(this.params.errorMessage));BX.hide(BX(this.params.variantListLayout));this.setFormStatus(true)}this.popup.adjustPosition()}},submitResult:function(t){if(!t||!t["result"]){alert("Error!")}if(t.result==="success"){this.popup.close();i(this.formElements["domainName"].value)}else if(t.error&&t.error=="WRONG_NAME"){this.popup.setContent('<div style="margin: 50px;">'+BX.message("B24_RENAME_POPUP_CHANGE_ERROR_WRONG_NAME")+"</div>");this.popup.setButtons([new BX.PopupWindowButtonLink({text:BX.message("JS_CORE_WINDOW_CLOSE"),className:"popup-window-button-link popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close();this.popupWindow.destroy();e=null}}})]);this.popup.adjustPosition()}else{this.popup.setContent('<div style="margin: 50px;">'+BX.message("B24_RENAME_POPUP_CHANGE_ERROR")+'<br /><br /><span style="color: red;">'+t.error+": "+t.error_description+"</span></div>");this.popup.setButtons([new BX.PopupWindowButtonLink({text:BX.message("JS_CORE_WINDOW_CLOSE"),className:"popup-window-button-link popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close();this.popupWindow.destroy();e=null}}})]);this.popup.adjustPosition()}},submit:function(){t=true;if(this.currentStatus===true){BX.ajax({dataType:"json",url:this.ajaxUrl,method:"POST",data:{action:"change",sessid:BX.bitrix_sessid(),domain:this.formElements.domainName.value,companyname:this.formElements.companyName.value},onsuccess:BX.proxy(this.submitResult,this)})}},confirm:function(e){if(this.currentStatus===false){BX.focus(this.formElements["domainName"])}else if(this.currentStatus===true){this.popup.setContent('<div style="margin: 20px">'+BX.message("B24_RENAME_POPUP_CHANGE_CONFIRM").replace("#domain#",this.params.zoneTpl.replace("#domain#",this.formElements["domainName"].value))+"</div>");this.popup.setButtons([new BX.PopupWindowButton({text:BX.message("B24_RENAME_POPUP_CONTINUE"),className:"popup-window-button-accept",events:{click:BX.proxy(this.submit,this)}}),new BX.PopupWindowButtonLink({text:BX.message("JS_CORE_WINDOW_CLOSE"),className:"popup-window-button-link popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}})]);this.popup.adjustPosition()}return BX.PreventDefault(e||window.event)}};BX.Bitrix24.renamePortal.Notify=function(){this.notifyPopup=null;this.data=null};BX.Bitrix24.renamePortal.Notify.prototype={show:function(){BX.ajax({url:s,method:"POST",dataType:"json",data:{action:"notify",sessid:BX.bitrix_sessid()},lsId:"change_domain_notify",lsTimeout:60,onsuccess:BX.delegate((function(e){if(!!e&&!!e.notify){this.data=e;BX.ready(BX.delegate(this.init,this))}}),this)})},init:function(){this.notifyPopup=new BX.PopupWindow("b24_portal_rename_notify",null,{closeByEsc:true,closeIcon:true,overlay:{opacity:50},content:'<div class="reg-popup-inner"><div class="reg-popup-title reg-popup-title-success"><span class="reg-popup-title-item">'+BX.message("B24_RENAME_NOTIFY_POPUP_TITLE")+'</span></div><div class="reg-popup-title reg-popup-inner-title"><span class="reg-popup-title-item">'+BX.message("B24_RENAME_NOTIFY_POPUP_COMPANY")+'</span><div class="reg-popup-company-name">'+BX.util.htmlspecialchars(this.data.company_name)+'</div></div><div class="reg-popup-title reg-popup-inner-title"><span class="reg-popup-title-item">'+BX.message("B24_RENAME_NOTIFY_POPUP_DOMAIN")+'</span><div class="reg-popup-company-url">'+BX.util.htmlspecialchars(this.data.new_domain)+"</div></div></div>",buttons:[new BX.PopupWindowButtonLink({text:BX.message("JS_CORE_WINDOW_CLOSE"),className:"popup-window-button-link popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}})]});BX.addCustomEvent(this.notifyPopup,"onPopupClose",BX.proxy(this.popupClose,this));BX.addCustomEvent("onBitrix24ChangeNameNotifyPopupClose",BX.proxy(this.popupCloseExternal,this));this.notifyPopup.show()},popupCloseExternal:function(){BX.removeCustomEvent(this.notifyPopup,"onPopupClose",BX.proxy(this.popupClose,this));this.notifyPopup.close()},popupClose:function(){BX.onGlobalCustomEvent("onBitrix24ChangeNameNotifyPopupClose");BX.userOptions.del("bitrix24","domain_changed")}};function i(e){var i=new BX.PopupWindow("b24_portal_rename",null,{overlay:{opacity:50},content:'<div style="margin: 20px;text-align: center; width: 500px;">'+(t?BX.message("B24_RENAME_POPUP_CHANGE_WAITING_ADMIN"):BX.message("B24_RENAME_POPUP_CHANGE_WAITING")).replace("#domain#",e)+"<br /><br />"+o()+"</div>"});i.show();var n=function(){var t=BX.ajax({dataType:"json",url:s,method:"HEAD",data:{action:"checkwait",sessid:BX.bitrix_sessid(),domain:e},onsuccess:function(){if(t.status==302||!t.status){a()}else{setTimeout(n,1e3)}},onfailure:a})};n()}function a(){if(location.href.indexOf("/settings/")>=0){setTimeout("location.href='/'",1e3)}else{setTimeout(BX.reload,1e3)}}function o(){return'<div class="b24-rename-user-loader"><div class="b24-rename-user-loader-item"><div class="b24-rename-loader"><svg class="b24-rename-circular" viewBox="25 25 50 50"><circle class="b24-rename-path" cx="50" cy="50" r="20" fill="none" stroke-width="1" stroke-miterlimit="10"/></svg></div></div></div>'}if(BX.message("B24_DOMAIN_CHANGED")=="Y"){var n=new BX.Bitrix24.renamePortal.Notify;n.show()}else{BX.addCustomEvent("onPullEvent-bitrix24",(function(e,t){if(e==="domain_change"){i(t.domain)}}))}if(window.location.href.indexOf("b24renameform")>0){setTimeout((()=>{BX.Bitrix24.renamePortal()}),0)}})();
//# sourceMappingURL=rename.map.js